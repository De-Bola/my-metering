<?xml version="1.0" encoding="UTF-8"?>
<databaseChangeLog
        xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog
                      http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-4.29.xsd"
        objectQuotingStrategy="QUOTE_ONLY_RESERVED_WORDS">

    <changeSet id="1744073082211-1" author="bhumm">
        <preConditions onFail="MARK_RAN">
            <not>
                <sequenceExists sequenceName="consumption_consumption_id_seq"/>
            </not>
        </preConditions>
        <createSequence incrementBy="1" sequenceName="consumption_consumption_id_seq" startValue="1"/>
    </changeSet>

    <changeSet id="1744073082211-2" author="bhumm">
        <preConditions onFail="MARK_RAN">
            <not>
                <sequenceExists sequenceName="customers_customer_id_seq"/>
            </not>
        </preConditions>
        <createSequence incrementBy="1" sequenceName="customers_customer_id_seq" startValue="1"/>
    </changeSet>

    <changeSet id="1744073082211-3" author="bhumm">
        <preConditions onFail="MARK_RAN">
            <not>
                <sequenceExists sequenceName="metering_points_metering_point_id_seq"/>
            </not>
        </preConditions>
        <createSequence incrementBy="1" sequenceName="metering_points_metering_point_id_seq" startValue="1"/>
    </changeSet>

    <changeSet id="1744073082211-4" author="bhumm">
        <preConditions onFail="MARK_RAN">
            <not>
                <tableExists tableName="consumption"/>
            </not>
        </preConditions>
        <createTable tableName="consumption">
            <column name="consumption_id" type="BIGINT GENERATED BY DEFAULT AS IDENTITY">
                <constraints nullable="false" primaryKey="true" primaryKeyName="consumption_pkey"/>
            </column>
            <column name="amount" type="DOUBLE precision">
                <constraints nullable="false"/>
            </column>
            <column name="amount_unit" type="VARCHAR(255)"/>
            <column name="consumption_time" type="timestamp"/>
            <column name="metering_point_id" type="BIGINT">
                <constraints nullable="false"/>
            </column>
        </createTable>
    </changeSet>

    <changeSet id="1744073082211-5" author="bhumm">
        <preConditions onFail="MARK_RAN">
            <not>
                <tableExists tableName="customers"/>
            </not>
        </preConditions>
        <createTable tableName="customers">
            <column name="customer_id" type="BIGINT GENERATED BY DEFAULT AS IDENTITY">
                <constraints nullable="false" primaryKey="true" primaryKeyName="customers_pkey"/>
            </column>
            <column name="first_name" type="VARCHAR(255)"/>
            <column name="last_name" type="VARCHAR(255)"/>
            <column name="password" type="VARCHAR(255)"/>
            <column name="username" type="VARCHAR(255)">
                <constraints nullable="false"/>
            </column>
        </createTable>
    </changeSet>

    <changeSet id="1744073082211-6" author="bhumm">
        <preConditions onFail="MARK_RAN">
            <not>
                <tableExists tableName="metering_points"/>
            </not>
        </preConditions>
        <createTable tableName="metering_points">
            <column name="metering_point_id" type="BIGINT GENERATED BY DEFAULT AS IDENTITY">
                <constraints nullable="false" primaryKey="true" primaryKeyName="metering_points_pkey"/>
            </column>
            <column name="address" type="VARCHAR(255)"/>
            <column name="customer_id" type="BIGINT">
                <constraints nullable="false"/>
            </column>
        </createTable>
    </changeSet>

    <changeSet id="1744073082211-7" author="bhumm">
        <preConditions onFail="MARK_RAN">
            <not>
                <uniqueConstraintExists tableName="customers" constraintName="ukbepynu3b6l8k2ppuq6b33xfxc"/>
            </not>
        </preConditions>
        <addUniqueConstraint columnNames="username" constraintName="ukbepynu3b6l8k2ppuq6b33xfxc" tableName="customers"/>
    </changeSet>

    <changeSet id="1744073082211-8" author="bhumm">
        <preConditions onFail="MARK_RAN">
            <not>
                <foreignKeyConstraintExists foreignKeyName="fkmsn07kr828ok70xnut26kit7j"/>
            </not>
        </preConditions>
        <addForeignKeyConstraint baseColumnNames="customer_id" baseTableName="metering_points"
                                 constraintName="fkmsn07kr828ok70xnut26kit7j" onDelete="NO ACTION"
                                 referencedColumnNames="customer_id" referencedTableName="customers"/>
    </changeSet>

    <changeSet id="1744073082211-9" author="bhumm">
        <preConditions onFail="MARK_RAN">
            <not>
                <foreignKeyConstraintExists foreignKeyName="fkq9tmo0r1mfe4aumnld00xv7el"/>
            </not>
        </preConditions>
        <addForeignKeyConstraint baseColumnNames="metering_point_id" baseTableName="consumption"
                                 constraintName="fkq9tmo0r1mfe4aumnld00xv7el" onDelete="NO ACTION"
                                 referencedColumnNames="metering_point_id" referencedTableName="metering_points"/>
    </changeSet>
</databaseChangeLog>
